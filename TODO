New Levels
----------
"Solitary" ("SOL") or "Confinement" ("CON"):
- Grid layout ("Manhattan-like"?):
  ...............................
  .####...####..####..####..####.
  .#..#...#..#..#..#..#..#..#..#.
  .#+##...#+##..#..#..#+##..#+##.
  ..............#..#.............
  .####...####..#..+..####..####.
  .#..#...#..#..#..#..#..#..#..#.
  .#+##...#+##..####..#+##..#+##.
  ...............................
  .####...##########..####..####.
  .#..#...#........#..#..#..#..#.
  .#+##...#######+##..#+##..#+##.
  ...............................
  .####...####..####..####..####.
  .#..#...#..#..#..#..#..#..#..#.
  .#+##...#+##..#+##..#+##..#+##.
  ...............................
- (Larger rooms are optional?)
- Each room has one goblin prisoner.
- Plenty of patrols, and guards at hallway junctions
- Layout leads to interesting gameplay, I think?

New mobs
--------
- creeping death
	- A sabre-toothed cat, nothing more or less.
	- Has LOS radius of just one more than player's.
	- Stalks player around.
	- After a bit, the cat charges and attacks player.
	- While charging:
		- 50% increased speed
		- Bite provides chance of paralysis
	- When player is in LOS of cat, messages:
		- "You feel like something is watching you."
		- "You feel uneasy." (just before cat charges)
x sulfur fiend
	x rElec∞ and rFire+.
	x Hasten Rot: makes a corpse emit a cloud of miasma, destroying the
	  corpse in the process. Miasma causes nausea.
	x Summon Ball Lightning: conjures a ball lightning mobs.
- fuming fiend
	- "A strange winged figure, cloaked in dirty rags. It is holding a
	   crystal sceptre."
	- Bolt of Dispersal: resistably blinks all affected mobs away. Used to
	  open LOS in order to see enemy.
	- Dispel Fumes: removes all clouds in caster's LOS, Used to remove gas
	  obscuring enemy.
	- Meat Offering: creates a dustling from a corpse, using it up in the
	  process.
	- Vunerable to fire, immune to electricity.
	- Fragile (20-30 HP) and slow (110).
	- Airstrike: moderate damage, smite-targeted.
	  - "The fuming fiend waves its arms around in wide circles!"
	  - "The air whirls around and strikes you!"
	  - "The air twists around and strikes you!"
	  - "The air twists itself inside-out and smites you!!"
x frozen fiend
	- "A winged humanoid, clothed in watery-blue robes. It whispers grimly
	   to itself as it patrols the dungeon, inspecting its underlings with
	   an expression of cold contempt.
	x Raises corpses into stationary foes. Such undead are very fast,
	  have good armor, and are quite tanky, but are very vunerable to fire.
	x Polar Casing: transforms a wall near the target to ice, damaging all
	  (yes, all) adjacent monsters. Reverts back to a wall in 5-6 turns.
	  - "The freezing fiend stares at you."
- dustling
	- Exceedingly fragile (1-5 HP) and no armor/weapons.
	- Carries a strong punch, though.
	- Fast (55% speed)
	- Vunerable to fire, electricity.
	- Summoned solely by fuming fiends.
- crystal servitor
	- "A humanoid statue carved out of a white crystal, imbued with an evil
	  spirit. It radiates an intense aura of palpable malice."
	- Appears in pairs in hallways of the Morgue.
	- Chance to resistibly blink intruders to itself.
- sapphire servitor
	- "A humanoid statue carved out of a white crystal, imbued with an evil
	  spirit. It radiates an intense aura of palpable malice."
	- Appears in pairs in hallways of the Morgue.
	- Chance to resistibly blink intruders away from itself.
- jasper servitor
	- "A humanoid statue carved out of a white crystal, imbued with an evil
	  spirit. It radiates an intense aura of palpable malice."
	- Appears in pairs guarding doorways of rooms in the Morgue.
	- Chance to prevent passage of intruders.
- lightning spire
	- like dcss' lightning spire
	- hurls powerful bolts of electricity
	- rFire+ rElec+ rMlee+ rFume∞ rPara∞ rPois∞
	- immobile, only attacks when other hostile present
- torpor spire
	- like dcss' torpor snail
	- attempts to slows player when in FOV
	- rFire+ rElec+ rMlee+ rFume∞ rPara∞ rPois∞
	- immobile
- iron spire
	- "A towering demonic spire, with a thousand eyes leering through its
	  iron plates. It shreds its enemies with shards of metal."
	- hurls iron shards and orbs of devastation
	- rFire+ rElec+ rMlee+ rFume∞ rPara∞ rPois∞
	- immobile, only attacks when other hostile present
x warden
	- calls for reinforcements by shouting/sounding horn
- wretched stars
	- "A fiery apparition, wreathed in unapproachable darkness. It has the
	  appearance of a wheel with broken spokes, covered within and without
	  in glazed eyes."
	- Extremely fast.
	- Mights allies.
	- Emanates opaque gas.
	  - Mobs that step in gas will be irresistibly blinked away.
	- When allies are about to die, gives them a status them makes them
	  very briefly invunerable and sends them insane. (Death's Door?)
	- Tries to blink around so as to not be adjacent to allies.
	- Teleports away (or suicides?) when no allies visible.
	- Immune to weapon damage.
x burning brute
	- "A raging winged demon composed primarily of boiling basalt,
	  feared even by its peers for its vicious fire attacks."
	x Has rFire∞, but rElec-.
	x Hurls bolts of fire.
	x Burnt offering: Raises a visible corpse, and gives it the .InnerFire
	  status. Effects:
	  - 50% slower.
	  - Every 2-3 turns, flames seep out of mob and ignite nearby tiles.
	  - When timer is over, mob explodes, damaging all nearby mobs.
	x Has kicking (x1) and clawing (x1) attack (need species struct for this).
- ancient mage
	- Summons ball lightning, orbs of devastation, wretched stars.
	- Hurls crystal shards.
	- Hurls bolts of paralysing dust (same as DCSS' catoblepas).
- death mage
	- Bufs nearby undead for a short time (and fights as well).
	- Haste: give .Fast to nearby undead ally.
	- Heal: Uses up a corpse to restore 90% of lost health for nearby undead ally.
	- morningstar + chain mail.
- jellies
	- Split on hit?
- bats
	- Harmless and multicolored, like DCSS' butterflies.
	- Glows, shedding light on surroundings.
- beastmaster
	- Slow (120) and heavily armored, but just a simple club.
	- Releases chained dogs, hounds, wolves in same room when seeing hostile.
	- Goads beasts on, possibly giving them .Enraged status

Intelligence
------------
- Levels: mindless, moron, animal, human, genius
- Stupid (<Human) mobs will have trouble determining what's a stronger enemy
  (morale system).
- Extra stupid (<Moron) mobs will employ ranged attacks even when it might hit
  another ally.
- Stupid (<Human) mobs will step on traps, mines, etc.
- Moron/mindless mobs will not reposition during a fight, and will not move off
  of dangerous terrain intelligently (they'll just move randomly).
- Mindless mobs will never flee.
- Unintelligent mobs cannot use doors and machines marked as requiring INT.

Undead
------
Undead:
- Intelligent: mindless.
- Has 150% strength bonus.
- Has -20% speed nerf.
- Has -40% dexterity nerf.
- Can only see 3-4 tiles ahead of them.
- Cannot hear noises.
- Have a .memory of ~7.
- Are vunerable to fire and electricity (rFire- rElec-).
- Are immune to Pain and Fear.
- Never flee, unless commanded so by their squad leader.
- Don't breath gases, and are thus not affected by most of them.
- Have a willpower of basically zero, and can thus be affected by any spell.
- Can be "called forth" by necromancers to assist in combat.


Movement patterns
-----------------
x sneak         [move, move, rest, move]
- merciless     [move(A), attack(A), move(A), attack(A)]
- counterattack [move(S), move(S), move(N), attack(A)]
- lunge         [move(A), move(A), move(A), attack(A)]
  - Daze/stun/paralyse/shove defender?
- sideswipe     [attack(N), move(NE), attack(W)]
- backstab      [attack(N), move(NE), move(NW), attack(S)]
- whirlwind     [attack(N), attack(S), attack(E), attack(W)]
  - (attack in four unique directions four times in a row)
  - active AoE ring abilities?
(See rings for other movement patterns.)


Rings
-----
- Rings will not work as soon as they are wielded, but must be worn for a few
  hundred turns to reach their full potential.
- Rings don't have an "enchantment" level, but "tiers" instead (mithril, gold,
  silver, and iron).
- Rings: [p]assive (acting each turn) or [a]ctive (requiring user to move in pattern)
ring of knowledge [a/p]
	- Passively allows player to know if they're still being pursued.
	- Allows player to see spots near pursuers (but not the pursuers
	  themselves?) for ~3-5 turns.
	  - Movement pattern:
ring of devastation [a]
	- Confers either stun or fear on mob when moving toward mob.
	  - Must land right next to mob.
	  - Movement pattern: [move(N), move(N), move(N), move(N)]
	- Can hurl crystal lance, to halve foe's health and knock them back,
	  halving health again if they are thrown into a wall.
	  .Loudest noise.
	- Can destroy a wall tile, sending shards of lethally sharp stone
	  hurtling towards adjacent mobs. Harder stones == more damage.
	  .Deafening noise.
ring of distortion [a]
	- Bend space: blink all mobs in FOV (& player) at random.
	  Twists space violently around player, reducing HP by 10%.
	- Aura of dispersal: creates aura around player where any mob in the
	  aura will be blinked away (& possibly paralysed) for 2-3 turns.
	  Twists space violently around player, reducing HP by 10%.
	- Scatter: teleport all mobs in FOV (& player) around floor. Player
	  should land in area without nearby mobs.
	  Twists space violently around player, reducing HP by 10%.
ring of singing [a/p]
	- Aura of silence: mutes all sound in vicinity for ~10 turns.
vampiric ring of draining [a/p]
	- Drains an enemy for {speed,health,HP}.
	- Allows player to see that mob and all tiles within two spaces.
	- Player will get a status (paralyzed? slowed? negative regen? traumatize? stun?)
	  for a bit when the enemy dies OR the enemy sees the player.
	- The drained mob immedietely becomes an enemy to everyone.
	- If the enemy dies, the player is teleported there in its place?
	- Movement pattern: ???
	- Also: when worn, allows player to sense nearby mobs.
		- Movement pattern: ???
ring of fire [a]
	- Causes dark gas to emanate from player. Gas is opaque and blocks all light.
		- Movement pattern:
	- Causes all nearby machines to lose power for a bit (aka turn out the lights).
		- Movement pattern:
	- Raises all nearby corpses to attack enemies for a brief period of time.
		- Movement pattern:
	- Causes tiles in 3-space radius around player to burst into flame.
		- Movement pattern:
	- Summons orbs of fire when moving straight away from foe. Orbs create
	  smoke/fog as they move and attack foes. Like Foxfire.
	- Ignition/Hellfire: fill all tiles with foes with fire. Sets caster on fire.
	  Puts clouds of fire around at random (potentially impeding escape).
ring of hexing [a]
	- Dismissal: forces all investigating mobs in LOS to return to working.
	  If resisted by willpower, will reveal player's location to them.


Potions/Vials
-------------
Potions: [s]tatus, [g]as, [c]ustom
x potion of confuzzlementation [g]
  Confusion.
x potion of petrification [g]
  Paralysis.
x potion of fog (TODO: name) [g]
  Fog.
x potion of acceleration [s]
  Haste.
x potion of coagulation
  Poison (occasional damage, slowness)
x potion of invigoration [s]
  Temporarily increases strength and dexterity.
- potion of incineration [c]
  Explodes when opened, setting surroundings on fire.
x potion of decimation [c]
  Explosion that destroys walls.
- potion of refrigeration [g]
  Freezes the surrounding air, slowing down cold-blooded mobs.
- potion of defoliation [g]
  Poison that destroys plants and/or fungi (releasing spores? hmmmm....).
- vial of tanus
  Status: backvision
    Makes mob see directly behind them as well as in front of them.
- vial of slade
  Status: bishop
    Makes mob unable to move in cardinal directions.
- vial of pholenine
  Status: rook
    Makes mob unable to move in diagonal directions.
- vial of chloroforon
- vial of hyine
- vial of quagenin
- vial of cataline
  Status: nightvision
    Gives mob perfect night vision.
- vial of flouin
  Status: dayblindness
    Makes mob unable to see in brightly-lit tiles.
- vial of phytin
  Status: nightblindness
    Makes mob unable to see in dimly-lit tiles.


Abominations
------------
Strange mobs found on LAB levels.
- Creeping Abomination
  - Like Blue Monk (in Hazard Level) or weeping angels.
- Slinking Abomination
  - Refuses to move into a tile that doesn't have at least one wall as a neighbor.
  - When spotted, IF the spotter is an enemy and has half of it's normal HP, it
    moves in and attacks, still keeping close to walls.
    Otherwise, it turns into a piece of artwork.
  - Game description should describe it as having an extremely hideous appearance.
- Undulating Abomination
  - Slow (speed == ~180?)
  - If enemy is less than X spaces away, it moves toward enemy.
  - Doesn't attack.
  - Emits gas that doesn't spread far. Gas slows down affected mobs. (100s => 150s)
  - If attacked, paralyzes player.
- Lacertilian Abomination
  - Hydra, multiple attacks per turn
- Tentacled Abomination
  - Abomination with twenty tentacles, like DCSS tile for ugly things
  - Almost as fast as player (85%).
  - Ranged attack: throws boulders at player (i.e., DCSS' cyclops).
  - Melee  attack: throws player across room to get more ranged hits.
  - Usually tries to attack ranged, but may occasionally rush across room
    and throw player around just for the heck of it.

Posters
-------
(moved to data/posters.tsv)


Books
-----
Trying to read an [unreadable] book results in:
	- "This book is written in Old Dramamos and you cannot read it."
Trying to read an [barbarians] book results in:
	- "This book is written in the language of the Western barbarians. You
	   read the book with great difficulty."
Trying to read a [forbidden] book results in:
	- "This book has a seal set on it, threatening would-be readers with
	   death. Really open?"
[unreadable] "Book of Damnation"
[unreadable] "Book of the Dead"
[unreadable] "Book of Torment"
[unreadable] "Of Men and Muskrats"
[unreadable] "Is Man a Myth?"
[forbidden]  "Book of Hymns"/"Soraldal"
[barbarians] "On the Goblins"/"Urukdal"
	- "You learn that two dark-skinned humans named Valimer and Kaiüs
	   visited a few hill-goblin settlements a thousand years ago."
"The Vale of Fear"/"Skarlef"
"Kornalg: The Life and Times of the Ancient Hill-King"
	- "You learn that Kornalg was undoubtedly the bravest, strongest,
	   besterestest hill-goblin that ever lived."
"This was Kornalg"
	- "You learn that Kornalg was rightly the king of the whole universe."
"Meing Krampgh"
	- "You learn that hill goblins are destined to rule the world."
	- "You learn that those filthy cave-goblins have been infiltrating
	   hill-goblin society for centuries."
"Histories of Men"
	- "You learn that dark-skinned humans are automatically inferior to other
	   fang-possessing bipeds."
"On the Descent of Goblins"
	- "You learn about the Hill Goblin Master Race."
"Durgh Stammer"
	- "You learn that hill goblins are vastly superior to cave goblins."
"The Path to Goblin Supremacy"
"The Weekly Hurricane"
	- "You learn that cave goblins are responsible for just about every
	   bad thing that happened to hill goblins in the past 10,000 years."
"On the Origins of Slade"
"An Inquiry into the Chemical Properties of Phytin"
"On the Molecular Structure of Tanus"
"Operating Traumbulnahl Machinery"
	- "You learn that human-leather gloves are required while operating
	  extractors."
"Optimizing Distance Functions"
	- "You learn that Chebyshev distance is to be preferred to Euclidean
	  distance for tile-based games."
"Optimizing the A* Algorithm"
	- "You learn about the Manhattan distance function."
"Origins of the Kaborego-Zin"/"Origins of the Creeping Death"
	- "You learn that the origins of the creeping death are a complete mystery."
"Daily Consumption of Butter Tea"
	- "You learn that some wacko humans actually like drinking rancid
	  butter mash."
	- "You learn the ratios of butter and tea needed to produce butter tea."
"A Short Guide on Brewing Kombucha"
	- "You learn that some weird humans actually like drinking spoiled tea."
	- "You learn the ratios of sugar and tea needed to brew kombucha."
"Oneirical's guide to the DCSS' FeSu"
	- "You learn that a few humans actually like scaled-down creeping deaths."
	- "You learn that some people like cats. A lot."
"Honeynutserios' DCSS review"
	- "You learn that DCSS v0.28 was the worst game in the world."
	- "You learn that DCSS v0.16 was the peak of DCSS."
	- "You learn that DCSS' dev team is a cabal of fun-hating baby eaters."
recipe books
	- "You learn how to pickle goblin roasts."
	- "You learn how to properly butcher humans carcases."
dungeon maps
	- maps of just mob stations
	- maps of just presence of walls/floors
	- maps of special item locations (rings/potions)
	- maps of machine locations (recharging stations/drains)
	- maps of possible stair locations


Materials (v = vial, s = stone, g = gem, o = ore/metal)
---------
g	vaand
g	chlorovese
g	chlus
g	caus
g	magenus
g	silus		Silicate, composes fire-proof cloaks.
g	chlade		Like mese in Minetest. Composes crystal statues. Glows.
			Associated with demonic powers.
o	magonium
o	beus
o	sylvium
o	magalt
o	vibonium
v	tanus		Extracted from talonium.
v	slade		Extracted from sulon.
v	pholenine	Extracted from phosire.
v	chloroforon
v	hyine		Extracted from hyalt.
v	quagenine	Extracted from quaese.
v	flouine
v	cataline	Extracted from catasine.
v	phytin		Extracted from phybro.
s	talonium	Ore of tanus.
s	sulon		Ore of slade.
s	phosire		Ore of pholenine.
s	hyalt		Ore of hyine.
s	quaese		Ore of quagenine.
s	catasine	Ore of cataline.
s	phybro		Ore of phytin.
s	dobalene	Makes up the walls of LAB.
s	nebro		Like slade in Dwarf Fortress -- extremely heavy.
			Associated with demonic powers.
s	vangenite	Makes up the walls of machinery in LAB. Glows dimly.
s	bolyvese
s	orthire		Uranium. Nuclear reactors are referred to as
			"Orthire Furnaces".
s	maron


Roadmap
=======
x Basic prefabs
x Allow for definition of a 'start' prefab
x Allow for placement of player in a location
x Allow for placement of specific item in a location
x Add exit staircase that exits game
x Add screen/confirmation for winning
x Add screen/confirmation for death
x Add potion struct, define some potions
x Throw some potions around during mapgen
x Allow picking up of potions
x Add dialog to view inventory
x Add dialog to use item in inventory (quaff potions)
x Add dialog to throw potion at mob
x Define armor struct, use on mobs and player
x Define melee weapon struct and dagger/spear, use on mobs and player
x Add the Openworld
x Allow stacking in inventory
x Add ranged weaponry
x Alternative weapons, weapon swapping
x Revamp sound system
x Fix message-displaying bugs
x Add basic power supply to vaults
x Create misc evocable items
x Create eldritch lantern evocable
x Create warning horn for Warden
x Create Warden, add to vaults, adjust mob ratio there
x Make executioner slower to move around
x Add treatures to Vaults
  x Create gold item/prop
  x Add armour and weapons (only ones that are useless to player)
x Add ability to present confirm/dialog boxes
* Add confirm boxes when:
  - Going to move into hostile's FOV
  x Going to move into a trap or stairs
  - Going to start running
x Show messages the normal way (i.e., top-to-bottom)
x Add morgue-file generation
x Show morgue to player on death/win
x Implement basic explosions (with wizard functionality)
x Add potion of decimation
x Add bomb-making evocables
x Rework and implement some items stuff
  x Increase size of inventory
  x Redo weapons/armor for player
    x robe, gambeson armor, leather armor, chain mail, scale mail
    x knife, dagger, stiletto, rapier, estoc(?)
  x Introduce speed/dexterity penalties for armor
  x Remove swords, replace with maces
  x Place evocables, potions, weapons, armor around dungeon
  x Place item "stockpiles" in PRI and VLT; remove some PRI subrooms to make place for it
  x Add messages when player finds evocable, recharging station, potion, or stairs
  - Prevent some rare items from spawning at all on lower floors
x Add recharging stations (and ensure they can't recharge mine kits!)
x Revamp confuse; add "daze" status
  x Fix: add mob to enemy list when they stab, and 90% chance to daze enemy (unless undead)
x Modify player starting environment
  x Starting messages ("You have just escaped...", "Probably pick up those item...")
  x Add some potions for player to use in starting area + weapon + armor
x Add malfunctioning machines
  x explosivity, electrocutivity
  x hammer evocable, player breaking machines
  x iron spike evocable, jamming doors
  x Engineers that repair machines/walls
x Implement cloaks
  x Add resistances
  x cloak of fur, silicon, velvet, thorns
  x Give engineers a cloak of fur
x Add fire system
  x potions of incineration
x Stair overhaul
  x Move stairs into walls, give different Brogue-like look
  x Organize branches and their levels; add stairs to them
  x Place stairs as far away from other stairs as possible
  x Add stair guardians to prevent stair-fleeing
  x Remove regeneration for monsters and players
    x Remove healing from ¡preservation; give ¡recuperation rMlee-
  x Nerf poison and pain damage
    x Merge poison and deceleration
  x Fountains to drink from
  x Apply "upgrade" and healing to player on ascension
- Add tougher monsters; balancing
  x Make fleeing monsters tell allies of foe
  x Flee effects (speed, enraged, shoving)
  x Necromancers, burning brutes, frozen fiends, sulfur fiends
  x Javelineers
  - Fuming fiends, other Smithing-only monsters
  x Add `Flanked` effect + UI element
  x Add mana system
  - Ancient mages, death mages and skeletal warrior squads
  - Place monsters in various areas
- Runes and scoring
- Air purifiers, mob repositioning AI to move out of dangerous tiles and flank foes
- More potions stuff
  - Dilution/concentration:
    - Potion of dilution   (dilution)
    - Grills + kitchen set (concentration)
  - Potion of defumigation
  - Nerf potions of acceleration
- Add fungi, plants, terrain
- Implement intelligence
  - Prevent dumb monsters from opening doors
  - Prevent sentinels from shooting allies and such
- Revisit and revamp SMI mapgen
  - toxic sludge pools and bridges over them
- Revisit Laboratory
  - Add spires and spire kits
  - Add command stones and transporter stones
  - Add bosses
  - Add traps of blinding gas
- Show information characters next to mob in enemy pane
x LOS/lighting revamp
  x Nerf player's LOS, buf enemies' LOS
  x Change lighting algorithm
  x Remove partial lighting?
  x Show walls as always lit?
- Fix/reimplement item-choosing screen
- Fix/reimplement tile-choosing screen
- Informational screens
  - "?" screen
  - "@" screen
  - Item info screen, 'i' key
  - E(x)amine screen
  - Poster description screen
- Add basic animations
- Weapon tiers
  - Ensure rarer tiers don't spawn on easy floors.
  - Add grindstones.
- Posters/books
  - Poster types (graffiti, announcement, engraving, etc)
  - Add bookshelves and book types
    - Maps
    - Useless books
- Squad overhaul
  - Patrol squads
  - Prisoner squads + goblin commanders
- Upgrade to Zig v9
  - Remove usage of usingnamespace
  - Petition khuxkm/ben for update
  - Remove utils.saturating_sub
  - Fix "*mem.Allocator" params

Ring and movements:
===================
- Define where rings should be in prefabs/mobs

Lighting/FOV:
=============
x Allow for prefabs to "seed" a map
  (Needed to ensure that power stations can appear on map)
x Refactor/cleanup FOV helper methods:
  x Generalize raycasting function
  x Add quadrants to raycasting
  x Use raycasting for everyone, remove shadowcasting
  x Use matrix to store mob's FOV, instead of array.
  x Update memoized sin/cos values
x Ensure that raycasting method doesn't have any artifacts
x Set a filter on area outside FOV (sepia? grayscale?)
x Show vision "energies" on FOV
x Make lighting system affect stealth/FOV
~ Make raycasting use bounding box instead of slower trigonometry method?

Temperature
===========
x Add temperature matrix, tickTemperature(); make magma emit heat
x Integrate with lighting system (make hot tiles emit light)
x Update tickTemperature() to work with material's specific heat

Room features/Mapgen:
=====================
- Allow close prefabs
- Make connectors flanked by floors a floor or door
- Add some lichen and fungi to rooms
  - brambles (retaliation; dmg on movement; 150% slowness)
  - fluorescent fungi
  - dead, flammable fungi
  - tall fungi (very reduced LOS)
- Terrain/floor types
  - camoflaging fungi (Stlth+)
  - metal (rElec-)
  - copper (elec dmg propagation?)
  - wood (rFire- rElec+)
  - carpet (Muffle+)
  - gravel (Muffle-)
  - ashes/gypsum (cloud of dust on movement)
x Add statues and chests to corners of rooms
x Add posters
~ Allow for prefabs to be rotated
x Allow for prefabs to have alternate layouts
x Allow for prefabs to be restricted to a map
x Create corridors between parallel prefabs/rooms
x Make the "lamps" electric "braziers"
  ~ Place them in center of rooms.
  x Place them in corners of rooms.
  x Make them explosive and electrocutive!
* Useless items in bins, cabinets, etc
  - dice, deck of cards
- Weapons and armor in cabinets
- Allow multiple subrooms in rooms (BSP?)
- Cave-like boundaries around edges of map in SMI
x Different types of power generators for different maps:
    x VLT:  coal furnace
    x PRI:  normal power plant
    x SMI:  turbines (geothermal)
    x LAB:  nuclear power plant
- Allow multi-width corridors (aka hallways)
- Prisoners chained up to the wall in PRI
- Preserved corpses lined up along walls in PRI?
  - Can be animated by angry necromancers.
- Useless items in various locations:
  - Potted mushrooms
  - chairs/tables
  - artwork
- Useless food items in barrels:
  - slime molds
  - mangosteins
  - (dried) mushrooms
  - dried meat
  - kombucha
  - bread
  - dried fish
  - dried salamander
  - alcohol (should use some made-up names, in gobbo language)

Morgue files
============
- Show annotated game notes (a la DCSS/Boohu).
- Count the number of times the player "got lucky" (i.e., was at critical HP
  but didn't take a hit hard enough to be killed).
- Show total (IRL) time duration of game.
- Show player's title.

Mobs, AI
========
x Make watchers shout loudly
x Allow mobs to shuffle past each other in corridors
x Ensure that laborers don't leave to investigate noises
x Ensure that the EnemyRecord counter is only decremented if the pursuer can
  see the last spot where the hostile was seen
- Move off of tile if that tile has dangerous gas
- Go into rage when encountering corpse of allied mob
- "Scan" room when encountering blood spattering
x Make watchers smack intruders when they can't run
- Mobs that throw potions of light at hostiles that are in areas too dark for
  them to see
- Fleeing mobs and mobs that have just spotted an enemy "tell" nearby allies
  about the hostile
x Define what undead are somewhere (combat bonuses, stat increases, miasma
  emissions, etc)
- Add rat+food system
  - Farmers and vending machines fill food stockpiles
  - Mobs go to stockpile, grab food, and eat
  - Mobs spatter crumbs on the floor
  - Rats, hiding in dark corners, emerge and eat/clean crumbs
  - Rats come to lick up blood and feast on corpses as well
  - Guards chase down rats and viciously kill them
  - Guards jumping around chasing rats creates another threat to player (guard
    may not be where the player last saw them!)
  - Or, if the above is too much, we'll add some harmless cats to kill rats.
  - Rats "spawn" in some way
  - etc
~ Make cleaners/engineers remove nets shot out by sentinels
- Revamp squad AI.
- Add morale system for each mob, affected by:
  - Loss of leader (squad)
  - Battlecry of leader (squad)
  - Presence of stronger allies
  - Presence of stronger enemies
  - Presence of many enemies
  - Pain,Fear effects
  - Miasma gas, other gases
  - Buffs on self or allies (haste, might, etc)
- Enemies that surrender or start whimpering when fleeing and trapped in a
  corner, or maybe perpare for one final all-out assault
  - Would provide excuse for .Enraged status implementation.
- Enemies that suicide when cornered and about to die.
- New: Smelling mechanics, dogs, hounds, creeping deaths
- New: Beastmasters
- Reaching weapon effects for beastmasters and patrols
- Make sentinels and javelineers pickup projectiles they've thrown

User Interface
==============
x Add padding between infopane/msgpane and map
x Make it easier to tell the heavily wounded from dead
x Fix showing of display percentage of last damage
x UI for status effects (paralysis, etc)
- Show red/yellow/orange for low health bars
x Use proper CP407 arrows for staircases
- Show prisoner's activity as "prisoner" instead of {"investigate","attack"}, etc
x Make bg of cell with noise green
- @ command to see player's full AC and stats
- Show information characters next to mob in enemy pane
  - @:   neutral
  - *:   ranged attacker (spells/launchers)
  - $:   carrying valuable items
  - c:   chained                    p:   prisoner
  - u:   unbreathing                i:   immobile
  - f:   faster than player         s:   slower than player
  - !:   extremely dangerous
  - P:   pursuing player            F:   fleeing player
  - I:   investigating player's noise

Items/Machines
==============
- Add cloaks:
  x cloak of silicon (fire resistance)
  x cloak of fur     (electricty resistance)
  x cloak of velvet
    - 30% chance for hostile to not notice mob, even when mob is in hostile's FOV
    - Slightly increases dexterity
  x cloak of thorns
    - 40% chance for a missed melee attack to backfire on attacker, dealing
      moderate damage.
- Add evocables:
  x "eldritch lantern": dazes or blinds mobs in FOV; blinds player
    for 2 turns. 4 charges.
  - "cannon kit" (SMI): creates permanent cannon on use (see below). 1 charge.
  - "lightning rod" (LAB): severely damages all mobs without rElec in FOV.
    - Note: implement electricity damage propagation for this.
  - "symbol of torment" (House): Gives .Fear to all mobs in FOV, and halves HP of
    all mobs (including evoker). Has no effect on rTorm or undead. ∞ charges.
    - "You raise the Symbol of Torment. Pain wracks your body!"
    - "The guard beholds the symbol and is wracked with agony!"
    - 10% chance for the Symbol to not affect player.
    - Inspired by DCSS' Symbol of Torment spell.
  - "blade trap kit": Creates blade trap on tile. 6 charges; cannot be recharged.
    - Blade trap:
      - Deals massive damage to *any* mob that steps on it, with 10% chance to
        evade trap. (Note, damage should not be enough to one-shot player.)
      - Will be avoided if possible by pathfinding AI.
      - Very quiet, maybe even silent.
      - Would be disabled by engineers.
  - "fume hood" (SMI): Grants rFume∞ for ~10 turns. 4 charges.
  x "hammer": Destroys a machine. ∞ charges; cannot be recharged.
  x "iron spike": Jams a door. 1 charge; cannot be recharged.
  - "blinding torch": Basically a laser. Can be evoked on a monster that can
    currently see the player (or *could* see the player, if its LOS was long
    enough), and will blind and daze that monster. 4 charges.
  - room reader (TODO: name) (LAB): Can be evoked on an opaque tile that's
    adjacent to the player, such as a door, and it will show player what's
    behind it as if player was standing there. 6 charges.
    - Inspired by that article demonstrating ability to roughly determine
      what's in a room by shining a laser through a keyhole and analysing how
      the light beams bounced around inside.
  x "mine kit": Creates mine on tile. 2 charges; cannot be recharged.
  - camera reader (TODO: name)
    - Can "hack" pre-placed cameras to spy on nearby areas for X turns?
  - "tinderbox": Ignites a single tile. Like Conjure Flame in DCSS. 6 charges.
  - "sparkthrower": Shoots a narrow beam of flames at a target. 6 charges.
- Add machines:
  - "cannons" (LAB): fires projectile in direction, eviscerating any mobs.
    Loud sound. 6 charges, pwr-station powered.
  - "floodgates" (PRI): creates permanent pool of shallow water.
    1 charge, pwr-station powered.
  - "canister of sludge" (SMI): can be "broken open" to release torrent of toxic
    sludge in direction, creating pool and damaging mobs. Takes 2 turns to empty.
    1 charge.
  - "canister of fuel" (VLT): can be "broken open" to release torrent of burning
    fuel in direction, incinerating mobs and creating pool/cloud of fire. Takes 4
    turns to completely empty. 1 charge.
  - "lightning vane" (LAB): kills all mobs without rElec in FOV. Deafening noise.
    4 charges, pwr-station powered.
  x recharging stations: 4 charges. 1-2 per level.
    - 'r' key is shortcut to evoke recharging station, when such a station is
      in LOS. Doing so invokes it for everything in inventory.
  - grindstones: Can be evoked to "sharpen" an edged/piercing weapon, "upgrading"
    it (worn → mediocre, mediocre → fine). Can only be evoked on a weapon once,
    and there's always a 10% chance for the weapon to break. 2 charges.
  - fountain: Can be evoked to heal player by half of lost health. 2 charges.
  - grill: Can be evoked to concentrate two potions into one, making its
    effect stronger. 3 charges. Found in a kitchen-like subroom.
  - summon stone: Summons a random (1-3) number of guards on the level to come
    to the command stone's location. 1 charge.
  - transporter stone: Teleports a random spire on the level to its location.
    1 charge.

Fires/explosions
================
x Make monsters flee sooner if burning?
- Make steam a fire retardant?

Message pane
============
- Messages:
  - On using ring (full power, half power, equipped)
  - On swapping with mob
  - On mob refusing to swap with player
  - On enemy turning to flee
  x On recieving a status (Confuse, Daze, etc)
  x On having the duration of status extended/lessened
  - On seeing a mob cast a spell
  x On dodging by enemy or player
  x On death
  - On resisting a spell
  - On swapping weapon
  - On making a noise, or mob making a noise
x Messages that require confirm/keypress
x Only print trap messages when culprit is player
x Group identical messages in msgpane
x Attack messages should be nice and descriptive ("You skewer the goblin!")
  x Even more descriptive! ("The troll smashes you like an overripe mango!!")

Fixes
=====
x Add walls to edges of map after mapgen
x Place stairs only in rooms
x Fix sound propagation
- Reject maps without enough open space
- Give player credit for deaths caused by malfunctioning machines
- Give player credit for deaths caused by fires
- Show appropriate number of exclamation points on messages about
  spell damage
- Don't allow confused monsters to attack diagonally.

Ideas
=====
[+] planned, [~] obsolete, [x] done
~ Layers, as in Brogue? (gas, liquid, surface, floor, etc.)
+ Cloaks of invisibility, confusion, blinding, camouflage, electricity
  resistance, fire resistance, etc.
  - cloak of shimmering: chance of daze mob that spots player?
- Ring of seeing (magic mapping)
~ Rings have negative effects (decreased piety/willpower)
  - obsolete: rings are expected to be worn at all times, not an item that can
    be swapped off or on depending on situation
~ Add bonus (or neg bonus) to attacker if defender moved or didn't move in the
  past two turns
  - obsolete: this game isn't cogmind. besides, too many obscure combat bonuses
    is bad.
~ Ring of intimidation that magic maps dungeon based on mob's memory
  - obsolete: mobs don't have memory. also, how would the UI tell what was mapped
    from another mob's memory vs what the player visited (maybe take a cue from
    cogmind and show such portions in greenscale/grayscale/bluescale?)
~ Crafting grid/alchemy by arranging items on map and dancing
  - obsolete: too complex
x Lighting system and torches
~ Light colors
  - obsolete: would complicate ui too much. "Is that floor color change from a
    light color, gas, or something else?"
x Ring of echolocation to magic-map neighbors of sound-producing tiles
- "Night", when guards sleep, torches go out, and night creatures awaken
- "Seed database" that stores bones for players who died during game, then
  shows ingame bones/corpses/undead on other games
- Candles that destory people/objects/rooms when quenched
- "Permeability" instead of walkability, that lets creatures pass if they are
  small enough (e.g., rats and small spires could pass through iron bars)
~ Tile "integrity" that reduces when tile is hit with explosion
  - obsolete: too complex
~ Radioactivity system: nuclear reactors, uranium, corium, nuclear bombs that
  the player can blow up for fun
  - obsolete: too complex
~ Orchestra/Concert, that sings/players instruments and distracts guards
	- Bonus: use Nazi singer names
  - obsolete: making all the guards move to one corner of the map suddenly is
    obviously going to make things easier for player /s
- Goblin "organizations" (purely eye candy)
	- the Goblin Brotherhood, the ProudGobbos, the Seven Percenters, the
	  Goblin Nations, etc
- Night creatures should pop out of artwork at night
~ Stone guardians that patrol map and cast confusion at enemies, but move at 1
  tile per 10-20 turns
  - obsolete: that's abominations now
- Headstones with previous player's comments on them, or ghosts that mourn
  previous player's carelessnes (think DCSS ghosts)
	- Bonus: the ghosts/gravestones are found in the temple in prison cells
~ Pub for guards to get drunk
  - obsolete: how would this affect gameplay? (maybe just a vault would be fine?)
- Ring to detect powered machines
- Ring/feature to detect what kind of mob made a noise
- Radioactive gas leaking from a warehouse on a few levels, so a kind of food
  clock
- Ability to rifle sleeping/drunk/stunned guards as well as corpses
- Lava flans
- Undead have other interesting kinds of negative effects when they score a
  hit?
	- Reduced max HP, less regen rate, reduced stealth
- Areas that speed up or slow down mobs
- Lichen/fungi that puts mobs to sleep (enchanted ground)
- Ice/oily floor that randomizes movement
- Sticky ground that reduces evasion
x Mobile traps that can be placed by player and used to lure guards on top
	x {Bombs/landmines, bear trap, damage trap} "kits"
x Item/lever player can trigger to unlock locked doors in room, releasing
  prisoners and creating maximum chaos.
+ Use Dijkstra for lighting/FOV?
~ Potion and Ring ID system.
  - obsolete: too complex
x Blood spattering?
- Speech bubbles in following situations:
  - On spotting an enemy ("Aha!", "It's a <species>!", "It's the @!!")
  - On being cornered ("Don't touch me!", "Go away!", "No farther!")
  - On seeing a dead ally, killed by a visible hostile ("Murderer!", "F*** you!")
  - On seeing a dead ally, killed by a nonvisible hostile ("Oh no!", "Noo!",
   "Noo! Not Bert!")
  - On pursuing a fleeing hostile ("Coward!", "Wimp!", "Clown!")
  - On investigating a noise ("...?", "What?")
  - On completing investigation of a noise ("Must have been rats!")
  - On finding an pursued enemy ("Its here!", "I've got you now!", "Now you're mine!",
    "I'll tear you into pieces!", "You miserable <species>!", "You miserable @!")
  - On about to kill player ("Not very good at this, hm?", "Times up!")
  - Two ways to possibly show such messages:
    - Show it like Smart Kobold, on the map.
    - Show it over the health/AI bar.
- Smell mechanics that allow, say, hellhounds and snakes to detect intruders
  even if they can't see them.
- Ranged melee weapons, e.g., spear and whips
x Add braziers that are built into the walls (aka torches), and use that
  instead for corridors
- Some kind of squad-forming fast-moving swarming mob, like killer bees (DCSS)
  or swarmers (Cogmind 7DRL)
- "cameras kits" that create surface items that keep the surrounding area in the
  FOV of all mobs that have a certain ring on
- Experiment with "bouncing" rays in raycasting routines
- Ring/item that has leaving a vunerable "copy" of yourself where that item/ring
  was activated (that is, *two* tiles have the .mob field pointing to the player,
  while the player.coord field points to only one of them).
- weapon runes:
	- interleaving: Swap on hit
	- banishing:    Teleports away
- MP-like system that limits how often spellcasters can cast spells (providing
  a way to tweak dangerous-ness) and how often player can use ring effects.
- Extremely dangerous (but lucrative) vaults that have golden walls, warning
  player of danger.
- Nice floor tile patterns, like Ultima Ratio Regum.
  E.g.:      #############    #############
             #·,·,·,·,·,·#    #·,·,·,·,·,·#
             #`.`.`.`.`.`#    #—.—.—.—.—.—#
             #,`,`,`,`,`,#    #—,—,—,—,—,—#
             #·,·,·,·,·,·#    #—.—.—.—.—.—#
             #`.`.`.`.`.`#    #·,·,·,·,·,·#
             #############    #############
- Bribing: bribe lone monsters to stay quiet, but they'll turn hostile again if
  an unbribed comrade shows up
  - Gold + jewelry collection
  - Bri(b)ing key to bribe lone monsters
- "Doormat" poster that has welcoming messages on it, right next to stairs
  - Maybe describes level's challenges for new players?

Optimizations
=============
- Use @mulAdd where possible (FOV, A*, Dijkstra, light/atmosphere/sound systems)
- Use @setCold(true) where possible (see above for places to look)
- Use SIMD where possible
x Use a matrix to mark nodes as closed (instead of a heap-allocated list) for
  Dijkstra.
x Use Manhattan distance for A* algorithm (overestimating heuristic might be better?)
- Allow functions that repeatedly call A* for the same mob to store an "AstarContext"
  structure that allows astar.path() to reuse cell cost, walkablility, etc data
  without calling those functions again.
- Use atan to calculate octant in which coord appears relative to mob's coord, instead
  of the slower method seen in Coord.closestDirectionTo()

Code cleanups
=============
- Defined unimplemented(), todo(), and oom()
- Stop using the `catch unreachable` syntax:
    libera#zig 19:58 <ikskuh> "catch unreachable" will happily continue to execute code
                              after the error in non-safe build modes
- Remove all floats from color functions, sound systems, gas systems, etc.
- Review usage of usize and change to u64/u32 where needed to prevent portability issues
- Define custom assert() that can give additional context
- Define Lua API and move the following to Lua data files:
  - levelFeature definitions (see mapgen.zig)
  - levelConfig (see mapgen.zig)
- Cleanup/factorize container/item manipulation code for Machine AI.

Refactorings
============
- Define Species struct and carry immutable data for each mob in it
x Convert enum+union pair to union(enum) (see std/fifo.zig) where needed
x Research Manhattan distance vs Euclidian distance vs Moore neighborhood:
  https://reddit.com/r/roguelikedev/comments/nev1jg/a_pathfinding_unstablenondeterministic/
x Add power component to machines
x Use Chebyshev instead of Manhattan distance
- Use arrays and indexes for state.* instead of linked lists and pointers
- Use linked list for roomslist, and use raw pointers instead of indexes
  whenever needed in mapgen code.
- Keep track of each connected room in mapgen, so that no room connects to the
  same room twice.

Tests
=====
x Ensure that distance() treats diagonal moves as more expensive than cardinal moves, or
  the opposite if Chebyshev is used later.
