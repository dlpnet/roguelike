New mobs
([s]pirit, [h]uman/elf, [a]nimal, [u]ndead, [o]ther)
([CE]Sauron, [LE]NoneEvil, [CG]NoneGood, [LG]Illuvatar, [CC]Sauron/NonEvil, [??]Neutral,
 [NN]NightCreature)
--------
CC	a	spiders
			- Web attacks that hold player in stasis.
			- Long-lived, slow acting poisoned bite.
CC	s	burning brute
			- Tremendously powerful fire attacks.
			- Can be leveraged against guards.
			"A winged demon composed primarily of boiling granite, capable of
			fearsome fire attacks."
CC	s	blazing brute
			- Upscaled version of burning brute?
CC	s	winged terror
			- Summoner.
CC	a	jackals
CC	a	hounds
CC	s	locust
CC	s	cankerworm
CC	h	wraith
CC	s	death angel
			- Essentially a necromancer, but much more powerful on its own.
			- Capable of striking certain mobs (low willpower, non-sentient
			  mobs, mindless mobs, or undead mobs) dead in one turn.
CE	s	greater, lesser, minor necromancer
			"An unusually fragile minor demon that has long wielded the secrets
			of life and death."
CE	h	orc
			"Middle-sized humanoids with skin only slightly darker than the
			underside of a rainbow trout, these ferocious beings are nothing
			like the misshapen apes that you've been told about around the
			evening campfire.
CE	a	hellhounds
CE	h	death/fire/ether knight
LE	s	will o' the wisp
CE	a	fire worm (salamander?)
CE	o	crystal statue
			- Confuses intruders that wander too closely.
			- Nearly indestructible, except by fire attacks.
			"A statue of some nameless humanoid creature than once inhabited
			the pits of Ud√πn. These statues are almost as rare as the
			translucent white crystal they're composed of."
CE	o	turquoise statue
			- Raises an awful shriek when the player passes it.
			- Nearly indestructible, except by fire attacks.
CE	o	kyanite statue
			- Emits paralysis gas when intruders wander too closely.
			- Nearly indestructible, except by fire attacks.
CE	u	lich
			- Ranged attacker. Hangs behind, flees when hostile closes in.
			- Bufs allies when they're wounded, allows non-undead mobs to
			  "taint" hostile.
			"The dessicated form of an ancient sorcerer, now controlled by the
			very necromantic powers he once served."
CE	a	troll
CE	o	floating eye(?)
LE	a	internet troll
LE	o	mimic
LG	s	shining one
LG	s	angel
LG	s	archangel
??	a	rat
??	a	quasit
??	o	lava flan
			- Emits small amounts of smoke.
			- Spawns around lava, made of lava.
			- Splits in two when struck with shearing damage.
			- Explodes on death.
NN	o	stalker (invisible)
			- Invisible.
			- Stalks victim, occasionally delivering blows.
NN	o	bogeyman (TODO: change name)
			- Stalks victim invisibly in groups of 3-5, then becomes visible
			  and gangs up to beat victim's skull in. Casts silence, but, as
			  with the bogeymen in Dwarf Fortress, constantly hurls insults
			  and cackles while attacking.
			- Incredibly good at dodging.
			"A emaciated humanoid creature of hideous appearance, possessed
			with eyes that are both dull and bright in the dungeon's gloom."
NN	o	night wanderer
			- A thin, sickly-looking creature that wanders the dungeon. Mostly
			  harmless.
NN	o	creeping death
			- Invisible.
			- Waits for victim to enter a dead end, then emits a suffocating
			  gas that envelopes victim. Said gas is completely opaque and is
			  jet black.
			"An invisible Presence of destroying fire that stalks the dungeon,
			wreathed in unapproachable darkness."
NN	o	grue
			- Like stalker, but dies when coming into contact with light.
NN	o	vampire

Feats (challenges)
------------------
sneak		Only attack and kill with stabs.
frugal		Use only one weapon throughout the game.
ringless	Use no rings at all.
naked		Use no cloaks at all.
chivalrous	Use only (unpoisoned) melee weapons, never ranged.
ringlord	Never remove a rings throughout the game.

Movement patterns
-----------------
sneak      [move, move, rest, move]
merciless  [move(A), attack(A), move(A), attack(A)]
charge     [move(A), move(A), move(A), attack(A)]
recuperate [rest, rest, rest, rest]
(See rings for other movement patterns.)

Rings
-----
- All rings will increase in power depending on... player experience? piety?
- All rings will have severe negative effects, most notably decreased willpower.
- Rings that work on hostile mobs will have their effects increased if the hostile
  mob has low willpower.
- Rings will not work as soon as they are wielded, but must be worn for a few
  hundred turns to reach their full potential.
- Rings don't have an "enchantment" level, but "tiers" instead (mithril, gold,
  silver, and iron).
- Rings: [p]assive (acting each turn) or [a]ctive (requiring user to move in pattern)
ring of intimidation [a]
	- Confers either stun or fear on mob when moving toward mob.
	- Movement pattern: [move(N), move(N), move(N), move(N)]
	// - Gives player knowledge of dungeon's layout, based on the intimidated mob's
	//   memory.
	// - Affected mobs should have a status effect... (`stunned` maybe?)
	// - High penalty, depending on affected mob's willpower.
ring of echolocation [p]
	- Gives player basic knowledge of dungeon's layout nearby sounds the player
	  can hear. The wearer will not know about dungeon features, just walls,
	  floors, and presence of water or lava.
	- Low penalty.
ring of clairvoyance
	- Allows player to sense presence of low-to-mid willpower mobs (the wearer
	  should not know what kind of mobs they are, though. A blue '?' is enough.)
	- Medium penalty.
ring of silence
	- Removes noise from a certain radius every turn.
	- Medium penalty, depending on the amount of total noise that was silenced.
ring of awareness
	- Gives player knowledge of hidden dungeon features that have been seen
	  by other mobs within a certain radius.
	- High penalty, depending on affected mob's willpower.
ring of protection
	- Shields player from lethal (but only lethal) hits and fatal poisonings.
	- Medium penalty, depending on how lethal the hit was.
ring of invisibility
	- Doesn't make wearer invisible, but prevents other hostiles from noticing
	  the wearer, even if they walk within inches of each other's nose.
	- High penalty, depending on affected mob's willpower.
ring of shattering
	- ???
ring of fire
	- Spews fire and smoke outward from the wearer when the wearer takes damage,
	  and when the wearer has been attacking the same tile for the past 4 turns.
	- Low penalty.
	- Example movement pattern: [attack(N), attack(N), attack(N), attack(N)]
ring of night
	- Radiates an aura of darkness around player.
	- Low penalty.
ring of light
	- Radiates a dark blue light around player, useful during the night.
	- Low penalty.
ring of death
	- Causes nearby corpses to (very briefly) come to life and attack adjacent
	  hostiles.
	- May result in a nearby necromancer taking unwelcome interest in you.
	- Low piety penalty.
ring of rage
	- ???
ring of power
	- Found only on wraiths.
	- ???
ring of evasion
	- Spews fog outward from player when zigzagging and fleeing, increasing evasion.
	- Example movement pattern: [move(NW), move(NE), move(NW), move(NE)]


Machines
--------
furnace
	- Heats air on one side of the chamber. May or may not be used by mobs.
	- If used by mobs: maybe to run an execution/torture chamber...?
	- If used by player: used to kill mobs in a vault?
cooler
	- Cools the surrounding air, helping to preserve e.g. food items.
forge
	- Stuff some metal on one end, and weapons will appear on the other.
book copy machine
	- Makes a book two.
memory condenser
	- "Condenses" player's memory into a (map) book.
food ration maker
	- Stuff fungi, lichen, and cadavers (I know, gross) next to it and rations
	  will appear on the other side.
camera
	- Pressure plate thing that puts an alert out if a non-Sauron-aligned
	  mob walks on it. (Alerts result in death squads sent out.)
alarm system
	- A Watcher can operate the alarm system when fleeing to send an alert
	  out, resulting in death squads being sent to the appropriate level.
announcement system
	- Player can operate this to get a popup detailing stuff about the dungeon.
	  E.g. "Squad LI-12 sent to put down rogue elf on level 2" or "Squad HE-7 sent
	  to destroy Burning Brute seen on level 7", or even "Food low on level 5".
teleportation station
	- Player can use it to teleport to a certain location.
uranium refinery
	- Should only appear in the Research branch.
	- Purely decor, until it's destroyed, in which case it'll release a bit
	  of corium.
potion synthesis machine
	- Should be a synthesis machine for each major potion.
	- Should only appear in the Research branch.
power station
	- Orc-powered power station.
nuclear reactor
	- Recharges power storage machines. When destroyed, releases massive
	  quantities of radioactive gases, noxious fumes, boiling uranium,
	  and lots of other nasty stuff, as well as a tremendous explosion.
heat-powered power station
	- If put in a hot place (ie next to lava), will self-power.
railgun
	- Should appear in the Research branch of the dungeon.
	- Unused by mobs, and mostly useless for player.
	- Zaps everything in a line, and self-destructs after X shots.
repair shop
	- Mobs and player may use it to repair weapons and armor.
air purifier
	- Clears away gases in a certain radius.
power storage
	- Powers all machines in a certain radius, until it itself runs out of
	  power. Useful for extending power station's range.
	- Player can destroy it to release electricity, zapping everything
	  (including player) in a certain radius.
elevator
	- Spawns mobs for death squads, or mobs when the number of laborers/guards
	  falls below a certain point
sonar mining laser
	- Unused by mobs, player can use it to blast away everything in a certain
	  radius, in a certain direction.
vending machine
	- Alternative to food stockpile...?
fire alarm
	- Registers a FireAlarm when heat increases around it, drawing mobs
	  designated as FireFighter towards it to remove the fire (if any --
	  they can't do anything if the "fire" is an angry burning brute).


Potions/Vials/Tonics
--------------------
TODO: decide difference between potions, tonics, and vials.
- Potions: [s]tatus, [g]as, [c]ustom
potion of cremation [c]
	- Explodes when opened, heating surrounding air.
potion of confuzzlementation [g]
	- Confusion.
potion of hallucination [g]
	- Hallucination.
potion of antifreeze (TODO: name) [s]
	- Increases cold immunity by a very small amount.
potion of refrigeration [g]
	- Freezes the surrounding air.
potion of petrification [g]
	- Paralysis.
potion of fog (TODO: name) [g]
	- Fog.
potion of acceleration [s]
	- Haste.
potion of asphyxiation [g]
	- Releases vapours that causes suffocation.
potion of preservation [c]
	- Heals 20% of health and removes poison.
potion of recuperation [s]
	- Causes faster regeneration rate.
potion of deceleration [s]
	- Slow paralysis.
potion of decimation [c]
	- Explosion that can destroy walls.
potion of defoliation [g]
	- Poison that destroys plants and/or fungi.
potion of dehumanization
	- Makes mob mindless?
potion of toxification [s]
	- Caustic poison.
potion of electrocution [s]
	- Makes target significantly more susceptible to electric attacks.
potion of fumigation [g]
	- Releases toxic fumes that clear away other toxic fumes.
potion of invigoration [s]
	- Temporarily increases strength.
potion of intoxication [s]
	- Drunkenness.
potion of irradiation [c]
	- Releases corium.
potion of starvation [s]
	- Increases digestion rate.
potion of dehydration
	- ???
potion of dilution
	- ???
potion of fluoridation
	- ???
potion of chlorination
	- ???
potion of negation
	- ???
potion of transubstantiation
	- ???
potion of coagulation
	- ???
potion of cognition
	- ???
potion of corruption
	- ???
potion of aviation
	- ???
potion of degeneration
	- ???
potion of desalination
	- ???
potion of divination
	- ???


Occupations
-----------
- Sentinel
	Purpose: Guard against the Openworld denizens, and raise alarm in case
	  of a wall breach and subsequent invasion.
	Guards entry points to Openworld.
	Guard vaults.
	Armed to the teeth, but stops attacking when intruder leaves radius
	Attempts to hold intruder in stasis with nets and shooting webs
	If intruder is too strong, flees and raises alarm, calling for
	  reinforcements
- Watchers
	Purpose: Give player a reason to think twice before entering room.
	Guards a single room, staying stationary.
	Very weak, but fast. Keeps its distance, and howls and yells when it
	  encounters an intruder.
- Guard
	Purpose: Keep player always on their toes.
	Walk in a squad from one room to another, and investigate noises.
	Moderately well armed, but slow.
- Warden
	Purpose: roam around, beating/whipping idlers.
	Weak, slow, and cowardly.
- Sentry
	Purpose: hide in cubbyhole in corridor or room, guarding.
	Poorly armed, normal speed.
	Attempts to hold intruder in stasis with nets and shooting webs,
	  while making a big racket.
- Firefighter
	Purpose: respond to fire alarms, and use extinguisher to put fire out.
	Travels in squads of 3-4. Can sprint to move 2.3 times as fast.
	Always wears heat-proof cloak, and carries extinguisher. Defenseless
	  against intruders.
	Should flee if it realizes that the "fire" is an angry Burning Brute.
- Scout
	Purpose: roam through dungeon, looking for things that need to be done.
	Reports the following: fires, bloody/dirty floors, overgrown fungi/plants
	  that need to be removed, broken machines/traps/props, wounded mobs that
	  are unconscious, and presence of corpses.
- Electrician
	Purpose: fix electricity-emitting machines.
	Fixes malfunctioning power supplies and power storage facilities, which
	  would otherwise electrocute a normal technician.
	Carries electricity-proof cloak.
- Technician
	Purpose: Fixes all other machines.
- Engineer
	Purpose: Fix traps and props.
- Doctor
	Purpose: heal wounded mobs.
	Carries herbs and medicine (aka potions) that heal wounded mobs (via
	  released vapours).
- Priest
	Purpose: Make the temple extremely dangerous.
	May release tainted gas at intruders.
	A special type of necromancer, but can only use that ability in "tainted"
	  areas that were designated so by the High Priest.
	Drags prisoners to altar, then burns the victim to death. Once cooked,
	  the victim's corpse is animated.
	Manufactures Potions of Tainting.
- Researcher
	Purpose: manufacture potions, and stand around, giving player something
	  interesting to look at.
	Uses machines and collections of vials to manufacture potions, placing
	  them in storeroom.
	Develops railgun and a few other big toys for player to fidget with.
- Farmer
	Purpose: make food for the entire dungeon.
	Farms fungi/mushrooms, harvesting them just before spore-producing stage.
	Places fungi/mushrooms next to machines, before operating the machine
	  and producing rations.
- Singer/Dancer
	Purpose: distract guards.
	Starts singing and dancing on a stage at a specified time, attracting
	  guards which have a low <discipline> field.
	Makes wardens not entirely useless, as they can now showup in the concert
	  halls to whip the slackers in there.
	Song names should be procedurally generated.
	Each concert hall should have a poster "NOW LIVE: <song>"


Posters
-------
- Production of human rations must increase by 33% by the middle of next week.
- Please do not feed the prisoners.
- Prison staffers must strive to be inclusive and welcoming to all new inmates.
- WANTED: <player>, escaped prisoner.
- Absence without leave is punishable by a mandatory interview with the
  High Priest.

Books
-----
"Melkor: The Life and Times of the King of Arda"
"This was Melkor"
"Meing Krampgh"
	- "You learn that hill goblins are destined to rule the world."
"On the Descent of Goblins"
	- "You learn about the Hill Goblin Master Race."
"Durgh Stammer"
	- "You learn that hill goblins are vastly superior to cave goblins."
recipe books
	- "You learn how to pickle goblin roasts."
	- "You learn how to properly butcher humans."
dungeon maps
inventory lists


Materials (v = vial, s = stone, g = gem, o = ore/metal)
---------
g	vaand
g	chlorovese
g	chlus
g	caus
g	magenus
g	silus		Silicate, composes fire-proof cloaks.
g	chlade		Like mese in Minetest. Composes crystal statues. Glows.
o	magonium
o	beus
o	sylvium
o	magalt
o	mithril		The mithril we all know and love.
o	vibonium
v	tanus
v	slade
v	sulon
v	pholenine
v	chloroforon
v	hyine
v	quagenine
v	flouine
v	catasine
v	cataline
v	phytin
s	nebro		Like slade in Dwarf Fortress -- extremely heavy.
s	bolvyese
s	vangenite
s	dobalene
s	hyalt
s	quaese
s	phybro
s	phosire
s	orthire
s	talonium
s	maron


Roadmap
-------

Basic stuff:
============
x Basic prefabs
x Allow for definition of a 'start' prefab
x Allow for placement of player in a location
x Allow for placement of specific item in a location
x Add exit staircase that exits game
x Add screen/confirmation for winning
x Add screen/confirmation for death
x Add potion struct, define some potions
x Throw some potions around during mapgen
x Allow picking up of potions
x Add dialog to view inventory
x Add dialog to use item in inventory (quaff potions)
x Add dialog to throw potion at mob
x Define armor struct, use on mobs and player
x Define melee weapon struct and dagger/spear, use on mobs and player
x Add the Openworld
x Allow stacking in inventory
x Add ranged weaponry
x Alternative weapons, weapon swapping

Ring and movements:
===================
- Define where rings should be in prefabs/mobs

Lighting/FOV:
=============
- Allow for prefabs to "seed" a map
  (Needed to ensure that power stations can appear on map)
x Refactor/cleanup FOV helper methods:
  x Generalize raycasting function
  x Add quadrants to raycasting
  x Use raycasting for everyone, remove shadowcasting
  x Use matrix to store mob's FOV, instead of array.
  x Update memoized sin/cos values
- Ensure that raycasting method doesn't have any artifacts
x Set a filter on area outside FOV (sepia? grayscale?)
x Show vision "energies" on FOV
x Make lighting system affect stealth/FOV
- Make raycasting use bounding box instead of slower trigonometry method?

Room features:
==============
- Moar materials for walls
- Add some lichen and fungi to rooms
- Add statues and chests to corners of rooms
- Add posters
- Add "palantirs"
- Allow for prefabs to be rotated
- Allow for prefabs to have alternate layouts
- Allow for prefabs to be restricted to a map
- Create corridors between parallel prefabs/rooms
x Make the "lamps" electric "braziers"
  - Place them in center of rooms.
  x Place them in corners of rooms.
  - Make them explosive and electrocutive!

Mobs, AI
========
x Make watchers shout loudly
- Allow mobs to shuffle past each other in corridors
- Add reproducing rats
x Ensure that laborers don't leave to investigate noises
- Ensure that the EnemyRecord counter is only decremented if the pursuer can
  see the last spot where the hostile was seen
- Move off of tile if that tile has dangerous gas

User Interface
==============
- Add padding between infopane/msgpane and map
- Make it easier to tell the heavily wounded from dead
- @ command to see player's full AC and stats
x Fix showing of display percentage of last damage
- UI for status effects (paralysis, etc)
- Ring messages (full power, half power, equipped)
x Only print trap messages when culprit is player
- Group identical messages in msgpane
x Attack messages should be nice and descriptive ("You skewer the goblin!")
  - Even more descriptive! ("The troll smashes you like an overripe mango!!")
- Show red/yellow/orange for low health bars
x Use proper CP407 arrows for staircases

Fixes
=====
- Add walls to edges of map after mapgen
- Place stairs only in rooms
- Fix sound propagation

Openworld:
==========
- Add portals to Openworld from the main dungeon, with sentinels
x Add goblins, rats, and other mobs to populate the Openworld
- Add temperature system
- Add Burning Brutes and Lava Flans to the Openworld
- Add lichen, fungi, and lava to the Openworld

Stretch goals:
==============
- Potion and Ring ID system.
- Blood spattering?
- Speech bubbles in following situations:
  - On spotting an enemy ("Aha!", "It's a <species>!", "It's the @!!")
  - On being cornered ("Don't touch me!", "Go away!", "No farther!")
  - On seeing a dead ally, killed by a visible hostile ("Murderer!")
  - On pursuing a fleeing hostile ("Coward!", "Wimp!")
  - On investigating a noise ("...?", "What?", "Must have been rats!")
- Smell mechanics that allow, say, hellhounds and snakes to detect
  intruders even if they can't see them.
- Ranged melee weapons, e.g., spear and whips
- Add braziers that are built into the walls, and use that instead for
  corridors
- Light colors

Optimizations
=============
- Use @mulAdd where possible (FOV, A*, Dijkstra, light/atmosphere/sound systems)
- Use @setCold(true) where possible (see above for places to look)
- Use SIMD where possible

Code cleanups
=============
- Defined unimplemented() and todo()
- Stop using the freaking `catch unreachable` syntax:
    libera#zig 19:58 <ikskuh> "catch unreachable" will happily continue to execute code
                              after the error in non-safe build modes
- Remove all floats from color functions, sound systems, gas systems, etc.

Refactorings
============
- Define Species struct and carry immutable data for each mob in it
x Convert enum+union pair to union(enum) (see std/fifo.zig) where needed
x Research Manhattan distance vs Euclidian distance vs Moore neighborhood:
  https://reddit.com/r/roguelikedev/comments/nev1jg/a_pathfinding_unstablenondeterministic/
x Add power component to machines
x Use Chebyshev or Moore Neighborhood instead of Manhattan distance

Tests
=====
x Ensure that distance() treats diagonal moves as more expensive than cardinal moves, or
  the opposite if Chebyshev/Moore is used later.
